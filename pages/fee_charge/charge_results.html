<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>费用收取结果</title>
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../../css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common.css" />
	</head>

	<body>
		<!--页面标题-->
		<header class="mui-bar mui-bar-nav header-title ">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">费用收取结果</h1>
		</header>
		<!--页面主体-->
		<div class="mui-content" id="content">
			<ul class="mui-table-view user-info">
				<li class="mui-table-view-cell">
					<span>用户编号：</span><span class="yonghu-info-code"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>用户姓名：</span><span class="yonghu-info-name"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>用户地址：</span><span class="yonghu-info-address"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>用户电话：</span><span class="yonghu-info-phone"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>账户余额：</span><span class="yonghu-info-balance"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>账户状态：</span>
					<span class="yonghu-info-state"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>气表编号：</span><span class="yonghu-info-number"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>价格标准：</span><span class="yonghu-info-standard">
					</span>
				</li>
				<button type="button" class="mui-btn-blue last-btn file-details-btn">档案详情</button>
			</ul>
			<ul class="mui-table-view user-info">
				<li class="mui-table-view-cell">
					<span>收费时间：</span>
					<span class="yingshoufei-xiaopiao-rq"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>　操作员：</span>
					<span class="yingshoufei-xiaopiao-username"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>账户余额：</span>
					<span class="yingshoufei-xiaopiao-je"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>实收金额：</span>
					<span class="yingshoufei-xiaopiao-bcje"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>　滞纳金：</span>
					<span class="yingshoufei-xiaopiao-latefee"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>本次余额：</span>
					<span class="yingshoufei-xiaopiao-zhje"></span>
				</li>
			</ul>
			<button type="button" class="mui-btn mui-btn-blue mui-btn-block re-charge-btn">重打小票</button>
		</div>
		<!--底部导航-->
		<footer class="mui-bar mui-bar-footer footer-nav">
			<a class="mui-pull-left fa fa-home go-home" id="go-home"></a>
			<a class="mui-pull-right fa fa-sign-out go-out" id="go-out"></a>
			<h1 class="mui-title" id="admin-name">使用者姓名</h1>
		</footer>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/printer.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/users_list.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/test.js" type="text/javascript" charset="utf-8"></script>
		<script>
			mui.init();
			mui.plusReady(function() {
				var savedBleId = localStorage.getItem("bleId"),
					gouqiMXid = localStorage.getItem("gouqiMXid"),
					gouqiMXapi = "http://223.85.248.171:8012/ashx/WebYonghuManagement.asmx/GetYonghuOneGouqiMx",
					/* 		printData = window.localStorage.getItem("printData").split(","), */
					PrintText1 = window.localStorage.getItem("PrintText1"),
					userName = window.localStorage.getItem("userName");
				if (savedBleId) {
					var bleObj = new ConnectPrinter(savedBleId);
				} else {
					plus.nativeUI.confirm('打印机未设置，是否前往设置？', function(e) {
						if (e.index === 0) {
							mui.openWindow({
								id: "/pages/printer.html",
								url: "/pages/printer.html"
							});
						}
					});
				}
				replayTicket = function(api, gouqiMXid) {
					$.ajax({
						url: api,
						type: "Post",
						data: {
							gouqimxId: gouqiMXid
						},
						timeout: 5000,
						beforeSend: function() {
							plus.nativeUI.showWaiting("等待中");
						},
						success: function success(data) {
							plus.nativeUI.closeWaiting();
							var data = JSON.parse(data.getElementsByTagName("string")[0].childNodes[0].nodeValue).ResultData;
							$(".yingshoufei-xiaopiao-rq").text(data.rq)
							$(".yingshoufei-xiaopiao-username").text(userName)
							$(".yingshoufei-xiaopiao-je").text(data.yhYE.toFixed(2))
							$(".yingshoufei-xiaopiao-bcje").text(data.sshoutotalje.toFixed(2))
							$(".yingshoufei-xiaopiao-latefee").text(data.Surcharge.toFixed(2))
							$(".yingshoufei-xiaopiao-zhje").text((data.yhYE + data.sshoutotalje - data.Surcharge).toFixed(2))

						},
						error: function error(data) {
							//200的响应也有可能被认定为error，responseText中没有Message部分
							//mui.alert(JSON.parse(data.responseText).Message);
							mui.alert("获取数据失败，请返回上级页面")
							plus.nativeUI.closeWaiting();
						},
						complete: function complete(data) {
							//after success or error
						}
					})
				};

				replayTicket(gouqiMXapi, gouqiMXid)
				$("#content").on("tap", ".re-charge-btn", function() {
					bleObj.gotoPrint("\r\n\r\n" + PrintText1 + "\r\n\r\n\r\n\r\n");
					bleObj = new ConnectPrinter(savedBleId);
				})
			})
		</script>
	</body>

</html>
