<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>费用记录</title>
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../../css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common.css" />
	</head>

	<body>
		<!--页面标题-->
		<header class="mui-bar mui-bar-nav header-title ">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">费用记录</h1>
		</header>
		<!--页面主体-->
		<div class="mui-content" id="content">
			<ul class="mui-table-view user-info">
				<li class="mui-table-view-cell">
					<span>用户编号：</span><span class="yonghu-info-code"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>用户姓名：</span><span class="yonghu-info-name"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>用户地址：</span><span class="yonghu-info-address"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>用户电话：</span><span class="yonghu-info-phone"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>账户余额：</span><span class="yonghu-info-balance"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>账户状态：</span>
					<span class="yonghu-info-state"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>气表编号：</span><span class="yonghu-info-number"></span>
				</li>
				<li class="mui-table-view-cell">
					<span>价格标准：</span><span class="yonghu-info-standard">
					</span>
				</li>
			</ul>
			<ul class="mui-table-view costing-list"></ul>
		</div>
		<!--底部导航-->
		<footer class="mui-bar mui-bar-footer footer-nav">
			<a class="mui-pull-left fa fa-home go-home" id="go-home"></a>
			<a class="mui-pull-right fa fa-sign-out go-out" id="go-out"></a>
			<h1 class="mui-title" id="admin-name">使用者姓名</h1>
		</footer>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/users_list.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/test.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function() {
				var costApi = "http://223.85.248.171:8012/ashx/WebYonghuManagement.asmx/GetYonghuGouqiMxBybyUser",
					dataId = window.localStorage.getItem("data-id"),
					userInfoApi = "http://223.85.248.171:8012/ashx/WebYonghuManagement.asmx/GetYonghuInfo",
					chargeResults={url:"/pages/fee_charge/charge_results.html",id:"charge_results.html"},
					feeCharge={url:"/pages/fee_charge/fee_charge.html",id:"fee_charge"},
					costRecord = function(api, dataId) {
						$.ajax({
							url: api,
							type: "Post",
							data: {
								pageNow: 1,
								pageSize: 100,
								yonghuId: dataId
							},
							timeout:5000,
							beforeSend: function() {
								plus.nativeUI.showWaiting("等待中");
							},
							success: function success(data) {
								plus.nativeUI.closeWaiting();
								var data = JSON.parse(data.getElementsByTagName("string")[0].childNodes[0].nodeValue).ResultData,
									data = JSON.parse(data);
								if (data.length != 0) {
									for (var i = 0; i < data.length; i++) {
										if (data[i].sfztcode == "3") {
											$(".costing-list").append("<li class=\"mui-table-view-cell cost-record-list\" caobiaoid=\"" + data[i].caobiaoid +
												"\" gouqimxid=\"" + data[i].gouqimxid +
												"\">\n        <p class=\"cost-record mui-pull-left\"><span class=\"cost-record-left\">\u8D26\u671F:" +
												data[i].kjyear + "-" + data[i].period + "</span><span class=\"cost-record-left\">\u8D77\u6570:" +
												data[i].Qids +
												"</span><span class=\"cost-record-left\">\u6B62\u6570:" + data[i].Zhids +
												"</span></p>\n        <a class=\"fa fa-angle-right mui-pull-right list-right\"></a>\n        <p class=\"cost-record mui-pull-right\"><span class=\"cost-record-right charge-state\">\u72B6\u6001:\u5DF2\u6536\u8D39</span><span class=\"cost-record-right\">\u6C14\u91CF\uFF1A"+data[i].qcTotalql+"</span><span class=\"cost-record-right\">\u91D1\u989D\uFF1A"+data[i].qctotalje+"</span></p>\n    </li>"
											)
										} else {
											$(".costing-list").append("<li class=\"mui-table-view-cell cost-record-list\" caobiaoid=\"" + data[i].caobiaoid +
												"\" gouqimxid=\"" + data[i].gouqimxid +
												"\">\n        <p class=\"cost-record mui-pull-left\"><span class=\"cost-record-left\">\u8D26\u671F:" +
												data[i].kjyear + "-" + data[i].period + "</span><span class=\"cost-record-left\">\u8D77\u6570:" +
												data[i]
												.Qids + "</span><span class=\"cost-record-left\">\u6B62\u6570:" + data[i].Zhids +
												"</span></p>\n        <a class=\"fa fa-angle-right mui-pull-right list-right\"></a>\n        <p class=\"cost-record mui-pull-right\"><span class=\"cost-record-right charge-state\">\u72B6\u6001:\u672A\u6536\u8D39</span><span class=\"cost-record-right\">\u6C14\u91CF\uFF1A"+data[i].qcTotalql+"</span><span class=\"cost-record-right\">\u91D1\u989D\uFF1A"+data[i].qctotalje+"</span></p>\n    </li>"
											)
										}

									}
								}
								/* mui.openWindow(usersList) */

							},
							error: function error(data) {
								//200的响应也有可能被认定为error，responseText中没有Message部分
								//mui.alert(JSON.parse(data.responseText).Message);
								mui.alert("获取数据失败，请返回上级页面")
								plus.nativeUI.closeWaiting();
							},
							complete: function complete(data) {
								//after success or error
							}


						});
					}
				costRecord(costApi, dataId)
				$(".costing-list").on("tap",".cost-record-list",function(){
				//判断收费状态跳转已收费收费页面或重打小票页面
					$(".charge-state").text=="状态：未收费"?mui.openWindow(feeCharge):mui.openWindow(chargeResults)
				})
			})
		</script>
	</body>

</html>
