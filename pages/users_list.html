<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>查询列表</title>
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/common.css" />
	</head>

	<body>
		<!--页面标题-->
		<header class="mui-bar mui-bar-nav header-title ">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">查询结果</h1>
		</header>
		<!--页面主体-->
		<div class="mui-content" id="content">
			<ul class="mui-table-view users-list">
				<!-- 	<li class="mui-table-view-cell">
					<p class="money-table-number"><span class="mui-pull-left users-name">户号: ${timeYhcode[i]}</span><span class="users-number mui-pull-left">金额：${timeSshoutotalje}元</span><span class="mui-pull-left is-read-false is-read">已作废</span></p>
					<a class="fa fa-angle-right mui-pull-right list-right"></a>
					<p class="users-address"><span class="address">户名：${timeYhname[i]}</span></p>
				</li> 
			 -->
			</ul>
		</div>
		<!--底部导航-->
		<footer class="mui-bar mui-bar-footer footer-nav">
			<a class="mui-pull-left fa fa-home go-home" id="go-home"></a>
			<a class="mui-pull-right fa fa-sign-out go-out" id="go-out"></a>
			<h1 class="mui-title" id="admin-name"></h1>
		</footer>
		<script src="../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/users_list.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var xiaoquid = window.localStorage.getItem("xiaoquid"),
				readBook = window.localStorage.getItem("readBook"),
				herfIndex = window.localStorage.getItem("herfIndex"),
				yonghuCode = window.localStorage.getItem("yonghuCode"),
				yonghuName = window.localStorage.getItem("yonghuName"),
				yonghuAdr = window.localStorage.getItem("yonghuAdr"),
				yhphone = window.localStorage.getItem("yhphone"),
				userID = window.localStorage.getItem("userID"),
				userName = window.localStorage.getItem("userName"),
				startTime = window.localStorage.getItem("startTime"),
				startTime = window.localStorage.getItem("startTime"),

				endTime = window.localStorage.getItem("endTime"),
				apiUsers = "http://223.85.248.171:8012/ashx/WebYonghuManagement.asmx/GetYonghuList",
				apiReading = "http://223.85.248.171:8012/ashx/WebYonghuManagement.asmx/GetYonghuChaoBiao",
				apiTime = "http://223.85.248.171:8012/ashx/WebYonghuManagement.asmx/GetYonghuGouqiMx",
				totalPage,
				userJson = {
					pageNow: 1,
					pageSize: 10,
					yonghuCode: yonghuCode,
					yonghuName: yonghuName,
					xiaoquId: xiaoquid,
					adr: yonghuAdr
				},
				readingJson = {
					pageNow: 1,
					pageSize: 10,
					caobiaoceId: readBook,
					yhcode: yonghuCode,
					yhname: yonghuName,
					yhphone: yhphone
				},
				timeJson = {
					pageNow: 1,
					pageSize: 10,
					userId: userID,
					fromDate: startTime,
					endDate: endTime
				}
			list = {
				usersList: function(dataJson, apiUsers) {
					$.ajax({
						url: apiUsers,
						type: "Post",
						data: dataJson,
						beforeSend: function() {
							plus.nativeUI.showWaiting("等待中");
						},
						timeout: 10000,
						success: function success(data) {
							plus.nativeUI.closeWaiting();
							mui('#content').pullRefresh().endPullupToRefresh(true);
							var data = JSON.parse(data.getElementsByTagName("string")[0].childNodes[0].nodeValue);
							for (var i = 0; i < data.ResultData.length; i++) {
								$(".users-list").append(
									"<li class=\"mui-table-view-cell user-id\">\n            <p class=\"name-table-number\"><span class=\"mui-pull-left users-name\">\u59D3\u540D: " +
									data.ResultData[i].yhname + "</span><span class=\"users-number mui-pull-left\">" + data.ResultData[i]
									.yhcode +
									"</span></p>\n            <a class=\"fa fa-angle-right mui-pull-right list-right\"></a>\n            <p class=\"users-address\">\u8054\u7CFB\u5730\u5740: <span class=\"address\">" +
									data.ResultData[i].AddressMS + "</span></p>\n         </li>");
							}
							//这里很重要，这里获取页码 公式：总条数/每页显示条数
							totalPage = data.ResultTotal % userJson.pageSize != 0 ?
								parseInt(data.ResultTotal / userJson.pageSize) + 1 :
								data.ResultTotal / userJson.pageSize;
							if (totalPage == userJson.pageNow) { //总页码等于当前页码，停止上拉下拉
								mui('#content').pullRefresh().endPullupToRefresh(true);
							} else {
								userJson.pageNow++;
								mui('#content').pullRefresh().refresh(true);
							}

							window.localStorage.setItem("xiaoquid", "")
						},
						error: function error(data) {
							//200的响应也有可能被认定为error，responseText中没有Message部分
							//mui.alert(JSON.parse(data.responseText).Message);
							mui.alert("获取数据失败，请返回上级页面", "温馨提示", "确定", function() {}, "div")
							plus.nativeUI.closeWaiting();
						},
						complete: function complete(data) {
							//after success or error
						}
					});
				},
				readingList: function(dataJson, apiReading) {
					$.ajax({
						url: apiReading,
						type: "Post",
						data: dataJson,
						beforeSend: function() {
							plus.nativeUI.showWaiting("等待中");
						},
						timeout: 10000,
						success: function success(data) {
							plus.nativeUI.closeWaiting();
							mui('#content').pullRefresh().endPullupToRefresh(true);
							var data = JSON.parse(data.getElementsByTagName("string")[0].childNodes[0].nodeValue);
							for (var i = 0; i < data.ResultData.length; i++) {
								if (data.ResultData[i].Qids == data.ResultData[i].Zhids) {
									$(".users-list").append(
										"<li class=\"mui-table-view-cell user-id\">\n            <p class=\"name-table-number\"><span class=\"mui-pull-left users-name\">\u59D3\u540D: " +
										data.ResultData[i].yhname + "</span><span class=\"users-number mui-pull-left\">" + data.ResultData[i].yhcode +
										"</span><span class=\"mui-pull-left is-read is-read-false\">\u672A\u6284\u8868</span></p>\n            <a class=\"fa fa-angle-right mui-pull-right list-right\"></a>\n            <p class=\"users-address\">\u8054\u7CFB\u5730\u5740: <span class=\"address\">" +
										data.ResultData[i].adr + "</span></p>\n        </li>");
								} else {
									$(".users-list").append(
										"<li class=\"mui-table-view-cell user-id\">\n            <p class=\"name-table-number\"><span class=\"mui-pull-left users-name\">\u59D3\u540D: " +
										data.ResultData[i].yhname + "</span><span class=\"users-number mui-pull-left\">" + data.ResultData[i].yhcode +
										"</span><span class=\"mui-pull-left is-read is-read-true\">\u5DF2\u6284\u8868</span></p>\n            <a class=\"fa fa-angle-right mui-pull-right list-right\"></a>\n            <p class=\"users-address\">\u8054\u7CFB\u5730\u5740: <span class=\"address\">" +
										data.ResultData[i].adr + "</span></p>\n        </li>");
								}
							}
							//这里很重要，这里获取页码 公式：总条数/每页显示条数
							totalPage = data.ResultTotal % readingJson.pageSize != 0 ?
								parseInt(data.ResultTotal / readingJson.pageSize) + 1 :
								data.ResultTotal / readingJson.pageSize;
							if (totalPage == readingJson.pageNow) { //总页码等于当前页码，停止上拉下拉
								mui('#content').pullRefresh().endPullupToRefresh(true);
							} else {
								readingJson.pageNow++;
								mui('#content').pullRefresh().refresh(true);
							}

							window.localStorage.setItem("xiaoquid", "")
						},
						error: function error(data) {
							//200的响应也有可能被认定为error，responseText中没有Message部分
							//mui.alert(JSON.parse(data.responseText).Message);
							mui.alert("获取数据失败，请返回上级页面", "温馨提示", "确定", function() {}, "div")
							plus.nativeUI.closeWaiting();
						},
						complete: function complete(data) {
							//after success or error
						}
					});
				},
				timeList: function(timeJson, apiTime) {
					$.ajax({
						url: apiTime,
						type: "POST",
						data: timeJson,
						timeout: 10000,
						beforeSend: function() {
							plus.nativeUI.showWaiting("等待中");
						},
						success: function success(data) {
							plus.nativeUI.closeWaiting();
							mui('#content').pullRefresh().endPullupToRefresh(true);
							var data = JSON.parse(data.getElementsByTagName("string")[0].childNodes[0].nodeValue).ResultData,
								data = JSON.parse(data),
								sshoutotalje = 0;
							for (var i = 0; i < data.length; i++) {
								sshoutotalje += parseFloat(data[i].sshoutotalje.toFixed(2))
								console.log(data[i].yhcode)
								if (!data[i].isOffset) {
									$(".user-list").append(
										" \n            <li class=\"mui-table-view-cell cost-li-list\">\n            <p class=\"money-table-number\"><span class=\"mui-pull-left users-name\">\u6237\u53F7: " +
										data[i].yhcode + "</span><span class=\"users-number mui-pull-left\">\u91D1\u989D\uFF1A" + Number(data[i].sshoutotalje).toFixed(2) +
										"\u5143</span><span class=\"mui-pull-left is-read is-read-false\")}>" + (data[i].isOffset ? "正常" :
											"已作废") +
										"</span></p>\n            <a class=\"fa fa-angle-right mui-pull-right list-right\"></a>\n            <p class=\"users-address\"><span class=\"address\">\u6237\u540D\uFF1A" +
										data[i].yhname + "</span></p>\n        </li>")
								} else {
									$(".user-list").append(
										" \n            <li class=\"mui-table-view-cell cost-li-list\">\n            <p class=\"money-table-number\"><span class=\"mui-pull-left users-name\">\u6237\u53F7: " +
										data[i].yhcode + "</span><span class=\"users-number mui-pull-left\">\u91D1\u989D\uFF1A" + Number(data[i].sshoutotalje).toFixed(2) +
										"\u5143</span><span class=\"mui-pull-left is-read is-read-true\")}>" + (!data[i].isOffset ? "已作废" :
											"正常") +
										"</span></p>\n            <a class=\"fa fa-angle-right mui-pull-right list-right\"></a>\n            <p class=\"users-address\"><span class=\"address\">\u6237\u540D\uFF1A" +
										data[i].yhname + "</span></p>\n        </li>")
								}
							}
// 							var dataTime =
// 								"<ul class=\"mui-table-view user-info\">\n            <li class=\"mui-table-view-cell\"><span class=\"\">\u6536\u8D39\u5458\uFF1A" +
// 								userName +
// 								"</span></li>\n            <li class=\"mui-table-view-cell\"><span class=\"\">\u8D77\u6B62\u65F6\u95F4\uFF1A" +
// 								startTime +
// 								"</span></li>\n            <li class=\"mui-table-view-cell\"><span class=\"\">\u7ED3\u675F\u65F6\u95F4\uFF1A" +
// 								endTime +
// 								"</span></li>\n            <li class=\"mui-table-view-cell\"><span class=\"\">\u7968\u636E\u6570\uFF1A" +
// 								data.length +
// 								"\u5F20</span></li>\n            <li class=\"mui-table-view-cell\"><span class=\"\">\u5408\u8BA1\u91D1\u989D\uFF1A" +
// 								sshoutotalje.toFixed(2) + "</span></li>\n        </ul>";
// 							$("#content").prepend(dataTime)
							//这里很重要，这里获取页码 公式：总条数/每页显示条数
							totalPage = data.ResultTotal % timeJson.pageSize != 0 ?
								parseInt(data.ResultTotal / timeJson.pageSize) + 1 :
								data.ResultTotal / timeJson.pageSize;
							if (totalPage == timeJson.pageNow) { //总页码等于当前页码，停止上拉下拉
								mui('#content').pullRefresh().endPullupToRefresh(true);
							} else {
								timeJson.pageNow++;
								mui('#content').pullRefresh().refresh(true);
							}

						},
						error: function(data) {
							//alert($.parseJSON(data.responseText).Message);
							/*				var jsonData = JSON.stringify(data); // 转成JSON格式
											var result = $.parseJSON(jsonData); // 转成JSON对象*/
							mui.alert("获取数据失败，请返回上级页面", "温馨提示", "确定", function() {}, "div")
							plus.nativeUI.closeWaiting();
						},
						complete: function(data) { //after success or error
						}
					})
				}


			};
			mui.init({
				pullRefresh: {
					container: '#content',
					down: { //下拉刷新
						auto: false, //可选,默认false.自动下拉刷新一次
						contentdown: "下拉可以刷新", //可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
						contentover: "释放立即刷新", //可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
						contentrefresh: "正在刷新...", //可选，正在刷新状态时，下拉刷新控件上显示的标题内容
						callback: function pulldownRefresh() {
							setTimeout(function() {
								switch (herfIndex) {
									case "0":
										list.usersList(userJson, apiUsers)
										break;
									case "1":
										list.readingList(readingJson, apiReading)
										break;
									case "2":
										list.usersList(userJson, apiUsers)
										break;
									case "3":
										list.timeList(timeJson, apiTime)
										break;
								}
							}, 1500);
						}
					},
					up: { //上拉加载
						auto: true, //可选,默认false.自动上拉加载一次
						contentrefresh: '正在加载...',
						contentnomore: '没有更多数据了', //可选，请求完毕若没有更多数据时显示的提醒内容；
						callback: function pulldownRefresh() {
							setTimeout(function() {
								switch (herfIndex) {
									case "0":
										list.usersList(userJson, apiUsers)
										break;
									case "1":
										list.readingList(readingJson, apiReading)
										break;
									case "2":
										list.usersList(userJson, apiUsers)
										break;
									case "3":
										list.timeList(timeJson, apiTime)
										break;
								}

							}, 1500);
						}
					}

				}
			});
		</script>
	</body>

</html>
